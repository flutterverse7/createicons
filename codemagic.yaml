workflows:

    sample-workflow:

        name: Codemagic Sample Workflow

        max_build_duration: 120

        instance_type: mac_mini_m2
workflows:

    android-workflow-id:

        name: Android Sample Workflow

        # .......    

        # .......

        # .......  

    ios-workflow-id:

        name: iOS Sample Workflow

        # ......
workflows:

    sample-workflow:

        environment:

            flutter: stable
workflows:

  ios-workflow:

    name: iOS Workflow 

    # ....

    environment:

      ios_signing:

        distribution_type: app_store # or: ad_hoc | development | enterprise

        bundle_identifier: com.example.id
  scripts:

    # ... your dependencies installation

    

    - name: Set up code signing settings on Xcode project

      script: xcode-project use-profiles

    

    # ... your build commands
  

  scripts:  

    # ... your dependencies installation  

    - name: Set up code signing settings on Xcode project  

      script: xcode-project use-profiles   

                --custom-export-options='{"testFlightInternalTestingOnly": true}'  

    # ... your build commands  
  scripts:

    - name: Set up code signing settings on Xcode project

      script: | 

        xcode-project use-profiles

    - name: Get Flutter packages

      script: | 

        flutter pub get

    - name: Install pods

      script: | 

        find . -name "Podfile" -execdir pod install \;

    - name: Flutter build ipa

      script: | 

        flutter build ipa --release \

          --build-name=1.0.0 \

          --export-options-plist=/Users/builder/export_options.plist

  artifacts:

    - build/ios/ipa/*.ipa

    - /tmp/xcodebuild_logs/*.log

    - flutter_drive.log
workflows:

  ios-workflow:

    name: iOS Workflow

    integrations:

      app_store_connect: <App Store Connect API key name>

    environment:

      vars:

        APP_STORE_APPLE_ID: 1555555551

    scripts:

      - name: Flutter build ipa

        script: | 

          BUILD_NUMBER=$(($(app-store-connect get-latest-app-store-build-number "$APP_STORE_APPLE_ID") + 1))

          flutter build ipa --release \

            --build-name=1.0.$BUILD_NUMBER \

            --build-number=$BUILD_NUMBER